# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

Продукт

```
interface IProduct {
  id: string;
  description: string;
  image: string;
  title: string;
  category: string;
  price: number | null;
}
```

Список продуктов

```
interface IProductList {
  items: IProduct[];
}
```

Заказ

```
interface IOrder {
  payment: string;
  email: string;
  phone: string;
  address: string;
  total: number;
  items: string[];
}
```

Результат заказа (ответ от сервера)

```
interface IOrderResult {
  id?: string;
  total?: number;
  error?: string;
}
```

Информация о заказе

```
type TOrderInfo = Pick<IOrder, 'payment' | 'email' | 'phone' | 'address'>;
```

Состояние формы

```
type TFormState = {
  valid: boolean;
  errors: string | null;
}
```

## Архитектура приложения

Код приложения разделён на слои согласно парадигме MVP:
- слой представления, отвечает за отображение данных на странице,
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь представления и данных.

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передаётся базовый адрес сервера и опциональных объект с заголовками запросов.
Методы:

- 'get' - Выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- 'post' - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт, переданный как параметр, при вызове метода. По умолчанию, выполняется 'POST' запрос, но метод запроса может быть  перееопределён  заданием третьего параметра при вызове.
- 'handleResponse' - принимает в качестве параметра ответ от функции fetch, анализирует ответ и если он имеет код 200, то возвращает Promise с объектом, который вернул сервер. 

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.
Основные методы, реализуемые классом описаны интерфейсом 'IEvents':

- 'on' - подписка на событие
- 'emit' - инициация события
- 'trigger' - возвращает функцию, при вызове которой инициируется требуемое в параметрах событие.

#### Класс Form
Реализует базовый функционал для работы с формами:
- при нажатии на кнопку с типом submit генерится событие <имя формы>:submit
- при изменении содержимого input'а генерится событие <имя формы>.<имя поля>:change

Имеет следующие методы:
- constructor(template: HTMLTemplateElement, events: IEvents) - конструктор получает HTML элемент формы в разметке и экземпляр брокера событий.
- 'clear()' - очищает поля формы
- 'render(state: Partial<T> & TFormState)' - В качестве параметра получает объект с данными для отображения формы. Возвращает экземпляр HTML элемента формы.
- 'valid:boolean' - свойство устанавливается в true когда все поля формы заполнены и имеют валидные данные
- 'errors:string' - свойство устанавливается в текст ошибки валидации, которое нужно отобразить

### Слой коммуникаций

#### Класс LarekApi
Предоставляет методы реализующие взаимодействие с бэкендом сервиса. Наследуется от класса Api.
Методы:

- 'getProductList' - делает запрос на сервер и получает список продуктов. Возвращает Promise со списком продуктов IProduct[].
- 'orderProducts' - делает запрос на сервер по созданию заказа. В качестве параметра получает объект типа IOrder, в котором передаются все данные по заказу. Возращает Promise с объектом, которым ответил сервер типа IOrderResult.

### Слой данных. Модели

#### Класс ProductListModel
Класс отвечает за хранение и логику работы со списком продуктов.\
Конструктор класса принимает экземпляр брокера событий.\
В полях класса хранятся следующие данные:

 - '_items: IProduct[]' - массив объектов продуктов

Так же класс предоставляет набор методов для взаимодействия с этими данными:

- 'getById(id: string): IProduct' - находит и возвращает продукт с заданным id
- 'items:IProduct[]' - возвращает список продуктов

#### Класс BasketModel
Класс отвечает за хранение и логику работы со списком продуктов помещённых в корзину для дальнейшей их покупке.\
Конструктор класса принимает экземпляр брокера событий.\
В полях класса хранятся следующие данные:

 - '_items: Set<string>' - Набор с идентификаторами продуктов, которые были добавлены в корзину

Так же класс предоставляет набор методов для взаимодействия с этими данными:

- 'add(id: string)' - добавляет в корзину продукт с заданным id
- 'delete(id: string)' - удаляет из корзины продукт с заданным id
- 'clear()' - удаляет все продукты из корзины
- 'has(id: string)' - проверяет есть ли товар с заданным id в корозине. Если товар есть, то возвращает true, иначе false
- 'count' - возвращает количество продуктов в корзине

#### Класс OrderInfoModel
Класс отвечает за хранение и логику работы с данными, необходимыми для оформления заказа.\
Конструктор класса принимает экземпляр брокера событий.\
В полях класса хранятся следующие данные:

- '_payment' - тип платежа
- '_address' - адрес доставки заказа
- '_email' - электронная почта покупателя
- '_phone' - телефон покупателя

Так же класс предоставляет набор методов для взаимодействия с этими данными:

- 'clear()' - Очищает данные во всех полях класса
- 'isPaymentValid(): boolean' - Проверяет правильное ли значение записанов поле _payment
- 'isPhoneValid(): boolean' - Проверяет правильное ли значение записанов поле _phone
- 'isEmailValid(): boolean' - Проверяет правильное ли значение записанов поле _email
- 'isAddressValid(): boolean' - Проверяет правильное ли значение записанов поле _address
- 'payment' - свойство возвращает и сохраняет значение поля _payment
- 'address' - свойство возвращает и сохраняет значение поля _address
- 'email' - свойство возвращает и сохраняет значение поля _email
- 'phone' - свойство возвращает и сохраняет значение поля _phone


### Классы представления
Все классы представления отвечают за отображение внутри контейнера (DOM-элемента) передаваемых в них данных.

#### Класс Modal
Реализует модальное окно. Предоставляет методы 'open' и 'close" для управления отображением окна. Устанавливает слушателей на клавиатуру, для закрытия подального окна по ESC, на клик на оверлее и кнопку 'Х' для закрытия окна.
- 'constructor(container: HTMLElement)' конструктор принимает HTML элемент - шаблон модального окна .

Поля класса:
- 'container: HTMLElement - элемент модального окна
- '_content: HTMLElement' - элемент, куда будет вставляться содержимое модального окна для отображения

#### Класс Basket
Реализует кнопку-иконку корзины с покупками. 

- 'constructor(container: HTMLElement, events: IEvents)' - конструктор получает HTML элемент кнопки в разметке и экземпляр брокера событий.

Поля класса:
- '_counter: HTMLElement' - счётчик HTML элемент, который показывапет количество продуктов в корзине

#### Класс BasketList
Реализует отображение списка продуктов в корзине.

- 'constructor(template: HTMLTemplateElement, events: IEvents)' - конструктор получает HTML элемент шаблон в разметке и экземпляр брокера событий.
- 'render(items: HTMLElement[], totalPrice: number)' - получает в качестве параметров список элементов для отображения и суммарная цена заказа. Возвращает HTML элемент копию заполненного шаблона.

Поля класса:
- 'element: HTMLElement' - копия HTML шаблона, описывающего список элементов в корзине
- 'events: IEvents' - экземпляр брокера событий
- 'price: HTMLElement' - HTML элемент, где отображается суммарная цена заказа
- 'button: HTMLButtonElement' - HTML элемент кнопки "Оформить"
- 'list: HTMLElement' - HTML элемент, где отображается список продуктов в корзине


#### Класс Product
Реализует отображение карточки продукта.

- 'constructor(template: HTMLTemplateElement, events: IEvents)' - конструктор получает HTML элемент шаблон в разметке и экземпляр брокера событий.
- 'render(data: IProduct, canAdd?: boolean)' - в качестве параметра получает объект с данными о продукте и флаг доступна ли кнопка "В корзину". Возвращает HTML элемент для отображения карточки продукта.
- 'id' - возвращает идентификатор продукта.

#### Класс ProductGallery
Реализует отображение списка продуктов на основном экране.

- 'constructor(container: HTMLElement)' - конструктор получает HTML элемент контейнер в разметке.
- 'render(items: HTMLElement[])' - в качестве параметра получает список элементов.

Поля класса:
- 'container: HTMLElement' - HTML элемент, где отображается список продуктов на главной странице

#### Класс OrderForm
Реализует отображение формы заказа при оформлении заказа. Наследуется от класса Form.

- 'constructor(template: HTMLTemplateElement, events: IEvents)' - конструктор получает HTML элемент шаблон в разметке и экземпляр брокера событий.
- 'clear()' - очищает поля формы
- 'payment' - свойство устанавливает тип платежа "Онлайн" или "При получении" для формы

Поля класса:
- 'card: HTMLButtonElement' - HTML элемент кнопки типа оплаты "Онлайн"
- 'cash: HTMLButtonElement' - HTML элемент кнопки типа оплаты "При получении"

#### Класс ContactsForm
Реализует отображение формы контактов при оформлении заказа. Наследуется от класса Form.

- 'constructor(template: HTMLTemplateElement, events: IEvents)' - конструктор получает HTML элемент шаблон в разметке и экземпляр брокера событий.

#### Класс Success
Реализует содержимое модального окна с сообщением об успешном создании заказа.

- 'constructor(template: HTMLTemplateElement, events: IEvents)' - конструктор получает HTML шаблона в разметке и экземпляр брокера событий.
- render(total: number) - получает в качестве параметра количество списанных синапсов и возвращает HTML элемент с содержимым модельного окна.

Поля класса:
- 'description: HTMLElement' - HTML элемент, где отображается сумарное количество потраченных синапсов
- 'button: HTMLButtonElement' - HTML элемент кнопки закрывающий модальное окно успешной покупки


## Взаимодействие компонентов
Код, описывающий взаимодействие слоя представления и слоя данных между собой находится в файле 'index.ts', выполняющем роль презентера.\
Взаимодействие осуществляется за счёт событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в 'index.ts'\.
В 'index.ts' сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

*Список всех событий, которые могут возникать в системе*
*События изменения данных (образуются классами моделями данных)*
- 'basket:click' - пользователь кликнул на иконке корзины
- 'basket:delete' - пользователь кликнул на иконке мусорного ведра в списке продуктов, которые лежат в корзине покупок
- 'basket:order' - пользователь нажал кпопку "Заказать" в списке продуктов, которые находятся в корзине
- 'basket:change' - изменилось содержимое корзины с продуктами. Добавили или удалили продукт из корзины
- 'productlist:change' - список продуктов загрузился с сервера
- 'product:click' - пользователь кликнул на карточке продукта в списке продуктов
- 'product:add' - пользователь нажал на кнопку, чтобы добавить продукт в корзину
- 'order:success' - пользователь нажал кнопку "Продолжить" на финальном экране после успешного создания заказа
- 'contacts.phone:change' - пользователь ввёл данные в поле "телефон"
- 'contacts.email:change' - пользователь ввёл данные в поле "email"
- 'contacts:submit' - пользователь нажал на кнопку "Оплатить"
- 'orderform:card' - пользователь нажал на кнопку оплатить "Онлайн"
- 'orderform:cash' - пользователь нажал на кнопку оплатить "При получении"
- 'order.address:change' - пользователь ввёл данные в поле адрес
- 'order:submit' - пользователь нажал на кнопку "Продолжить" при оформлении заказа
- 'orderinfomodel:change' - изменились данные о заказе
